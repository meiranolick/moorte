/*
---
description: Rich Text Editor (WYSIWYG / NAWTE / Editor Framework) that can be applied directly to any collection of DOM elements.

copyright:
- November 2008, 2010 Sam Goody

license: OSL v3.0 (http://www.opensource.org/licenses/osl-3.0.php)

authors:
- Sam Goody <siteroller - |at| - gmail>

requires:
- core

provides: [MooRTE, MooRTE.Elements, MooRTE.Utilities, MooRTE.Range, MooRTE.Path, MooRTE.ranges, MooRTE.activeField, MooRTE.activeBar ]

credits:
- Based on the tutorial at - http://dev.opera.com/articles/view/rich-html-editing-in-the-browser-part-1.  Bravo, Olav!!
- Ideas and inspiration - Guillerr, CheeAun, HugoBuriel
- Some icons from OpenWysiwyg - http://www.openwebware.com
- Cleanup regexs from CheeAun and Ryan's work on MooEditable (methodology is our own!)
- MooRTE needs YOU!!

Join our group at: http://groups.google.com/group/moorte

...
*/
var loopStop=0;Browser.webkit=Browser.safari||Browser.chrome;Object.extend("set",function(a,b){var c={};c[a]=b;return c});
var MooRTE=new Class({Implements:[Options],options:{floating:!0,padFloat:!0,where:"before",stretch:!1,location:"elements",buttons:"div.Menu:[Main,File,Insert]",skin:"Word03",elements:"textarea, .rte"},initialize:function(a){this.setOptions(a);var b,c=this,d=$$(this.options.elements),f=this.options.location.substr(4,1).toLowerCase();MooRTE.activeField||MooRTE.extend({ranges:{},btnVals:[],activeField:"",activeBar:""});Browser.ie||MooRTE.btnVals.push("unselectable");d.each(function(a,g){"textarea,input".contains(a.get("tag"),
",")&&(d[g]=a=c.textArea(a));if(f=="e"||!b)b=c.insertToolbar(f);"bt".contains(f)?a.set("contentEditable",!0):f=="e"?c.positionToolbar(a,b):MooRTE.Utilities.addEvents(a.set("contentEditable",!0),{focus:function(){c.positionToolbar(a,b)},blur:function(){this.setStyle("padding-top",this.getStyle("padding-top").slice(0,-2)-b.getFirst().getSize().y).removeClass("rteShow");b.addClass("rteHide")}});Browser.firefox&&(a.innerHTML+="<p id='rteMozFix' style='display:none'><br></p>");a.store("bar",b);MooRTE.Utilities.addEvents(a,
{keydown:MooRTE.Utilities.shortcuts,keyup:MooRTE.Utilities.updateBtns,mouseup:MooRTE.Utilities.updateBtns,focus:function(){MooRTE.activeField=this;MooRTE.activeBar=b}});MooRTE.Utilities.addEvents(b,{mouseup:MooRTE.Utilities.updateBtns})});b.store("fields",d);MooRTE.activeField=d[0];MooRTE.activeBar=MooRTE.activeField.retrieve("bar");f=="t"?b.addClass("rtePageTop").getFirst().addClass("rteTopDown"):f=="b"&&b.addClass("rtePageBottom");Browser.firefox&&MooRTE.Utilities.exec("styleWithCSS")},insertToolbar:function(a){a=
(new Element("div",{"class":"rteRemove MooRTE "+(!a||a=="n"?"rteHide":""),contentEditable:!1})).adopt(new Element("div",{"class":"RTE "+this.options.skin})).inject(document.body);MooRTE.activeBar=a;MooRTE.Utilities.addElements(this.options.buttons,[a.getFirst(),"bottom"]);return a},positionToolbar:function(a,b){a.set("contentEditable",!0).addClass("rteShow");var c=this.options,d=a.getCoordinates(),f=a.addClass("rte"+(c.stretch?"":"No")+"Stretch").getStyle("border-width").match(/(\d)/g);f=b.removeClass("rteHide").setStyle("width",
d.width-(c.floating?0:f[1]*1+f[3]*1)).getFirst().getCoordinates().height;if(c.floating){var e={before:"margin-top",after:"margin-after",top:"padding-top",bottom:"padding-bottom"}[c.where];a.setStyle(e,parseInt(a.getStyle(e))+f);c.padFloat||a.setStyle("min-height",d.height-f).setStyle("height",d.height-f);b.setStyles({left:d.left,top:d.top-f>0?d.top:d.bottom}).addClass("rteFloat").getFirst().addClass("rteFloat")}else a.setStyle("padding-top",a.getStyle("padding-top").slice(0,-2)*1+f).grab(b,"top")},
textArea:function(a){var b=(new Element("div",{text:a.get("value"),"class":"rteTextArea "+a.get("class"),styles:{width:a.getSize().x}})).setStyle(Browser.ie?"height":"min-height",a.getSize().y).store("src",a).replaces(a);a.store("new",b);var c=a.getParent("form");c&&MooRTE.Utilities.addEvents(c,{submit:function(){a.set("value",MooRTE.Utilities.clean(b)).replaces(b)}});return b}});
MooRTE.Range={create:function(a){var b=window.document.selection||window.getSelection();if(!b)return null;return MooRTE.ranges[a||"a1"]=b.getRangeAt?b.getRangeAt(0):b.createRange()},get:function(a,b){b||(b=MooRTE.Range.create());switch(a){case "text":return b.text||b.toString();case "node":return b.cloneContents?b.cloneContents():new Element("div",{html:b.htmlText});default:case "html":var c=b.htmlText;if(!c)c=b.cloneContents(),MooRTE.Range.content.empty().appendChild(c),c=MooRTE.Range.content.innerHTML;
return c}},set:function(a){a=MooRTE.ranges[a||"a1"];if(a.select)a.select();else{var b=window.getSelection();b.removeAllRanges();b.addRange(a)}return MooRTE.Range},insert:function(a,b){Browser.ie?(b||(b=MooRTE.Range.create()),b.pasteHTML(a)):MooRTE.Utilities.exec("insertHTML",a);return MooRTE.Range},wrap:function(a,b,c){c||(c=MooRTE.Range.create());a=new Element(a,b);try{Browser.ie?c.pasteHTML(a.set("html",c.htmlText).outerHTML):c.surroundContents(a)}catch(d){if(d.code==1)return!1}return a},wrapText:function(a,
b){var c=b.getParent(".RTE").getElement("textarea");a.substr(0,1)!="<"&&(a='<span style="'+a+'">');if(Browser.ie)e=new Element(a||"span",{html:range.get()}),range.pasteHTML(e);else{var d=c.selectionStart,f=RegExp("(.{"+d+"})(.{"+(c.selectionEnd-d)+"})(.*)","m").exec(c.get("value")),e=a+f[2]+"</"+a.match(/^<(\w+)/)[1]+">";c.set("value",f[1]+e+f[3]).selectionEnd=d+e.length}return MooRTE.Range},replace:function(a,b){b||(b=MooRTE.Range.create());if(Browser.ie){var c=document.uniqueID;b.pasteHTML("<span id='"+
c+"'></span>");a.replaces(document.id(c))}else MooRTE.Utilities.exec("inserthtml",a)},parent:function(a){if(!(a=a||MooRTE.Range.create()))return!1;return Browser.ie?typeOf(a)=="object"?a.parentElement():a:a.commonAncestorContainer}};(function(){if(Browser.firefox)MooRTE.Range.selection=window.getSelection();if(!Browser.ie)MooRTE.Range.content=new Element("div")})();
MooRTE.Utilities={exec:function(a){a=Array.from(a);document.execCommand(a[0],a[2]||null,a[1]||!1)},addEvents:function(a,b){Object.append(a.retrieve("rteEvents",{}),b);a.addEvents(b)},removeEvents:function(a,b){Object.each(a.retrieve("rteEvents",{}),function(b,d){a.removeEvent(d,b)});b&&a.eliminate("rteEvents")},shortcuts:function(a){if(a.key=="enter"){if(!Browser.ie)return;a.stop();return MooRTE.Range.insert("<br/>")}var b=MooRTE.activeBar.retrieve("shortcuts");a&&a.control&&b[a.key]&&(a.stop(),a=
MooRTE.activeBar.getElement(".rte"+b[a.key]),a.fireEvent("mousedown",a))},updateBtns:function(){var a,b=MooRTE.activeBar.retrieve("update");b.state.each(function(b){if(b[2])b[2].call(b[1],b[0]);else{try{a=window.document.queryCommandState(b[0])}catch(d){a=!1}b[1][(a?"add":"remove")+"Class"]("rteSelected")}});b.value.each(function(b){(a=window.document.queryCommandValue(b[0]))&&b[2].call(b[1],b[0],a)});b.custom.each(function(){vals[2].call(vals[1],vals[0])});Browser.firefox&&MooRTE.Range.selection.anchorNode.id==
"rteMozFix"&&MooRTE.Range.selection.extend(MooRTE.Range.selection.anchorNode.parentNode,0)},addElements:function(a,b,c){MooRTE.btnVals.args||MooRTE.btnVals.combine(["args","shortcut","element","onClick","img","onLoad","source","contains"]);if(b){if(Type.isArray(b)){var d=b[1];b=b[0]}}else b=MooRTE.activeBar.getFirst();c||(c={});if(typeOf(a)=="string"){a=a.replace(/'([^']*)'|"([^"]*)"|([^{}:,\][\s]+)/gm,"'$1$2$3'");a=a.replace(/((?:[,[:]|^)\s*)('[^']+'\s*:\s*'[^']+'\s*(?=[\],}]))/gm,"$1{$2}");for(a=
a.replace(/((?:[,[:]|^)\s*)('[^']+'\s*:\s*{[^{}]+})/gm,"$1{$2}");a!=(a=a.replace(/((?:[,[]|^)\s*)('[^']+'\s*:\s*\[(?:(?=([^\],\[]+))\3|\]}|[,[](?!\s*'[^']+'\s*:\s*\[([^\]]|\]})+\]))*\](?!}))/gm,"$1{$2}")););a=JSON.decode("["+a+"]")}var f=[],e=0;do f.length&&(a=f,f=[]),Array.from(a).each(function(a){switch(typeOf(a)){case "string":f.push(a);break;case "object":Object.each(a,function(a,b){f.push(Object.set(b,a))});break;case "array":a.each(function(a){f.push(a)}),e=a.length}});while(e);var g=b.hasClass("MooRTE")?
b:b.getParent(".MooRTE");f.each(function(a){if(Type.isObject(a)){var e=Object.values(a)[0];a=Object.keys(a)[0]}var f=".rte"+a.replace(".",".rte")+(c.className?"."+c.className.replace(" ","."):""),j=b["get"+({before:"Previous",after:"Next",top:"First"}[d]||"Last")](f);a=a.split(".")[0];if(!j||!c.useExistingEls){var i=MooRTE.Elements[a],m=i.element&&i.element.toLowerCase()=="textarea",k="text,password,submit,button,checkbox,file,hidden,image,radio,reset".contains(i.type),n="bold,italic,underline,strikethrough,subscript,superscript,unlink,insertorderedlist,insertunorderedlist".contains(a.toLowerCase(),
","),o=Object.append({href:"javascript:void(0)",unselectable:k||m?"off":"on",title:a+(i.shortcut?" (Ctrl+"+i.shortcut.capitalize()+")":""),styles:i.img?isNaN(i.img)?{"background-image":"url("+i.img+")"}:{"background-position":"0 "+-20*i.img+"px"}:{},events:{mousedown:function(b){MooRTE.activeBar=g;var c=g.retrieve("source"),d=g.retrieve("fields");if(!d.contains(MooRTE.activeField))MooRTE.activeField=d[0];d=MooRTE.Range.parent();if(Browser.webkit&&d.nodeType==3)d=d.parentElement;MooRTE.activeField.contains(d)&&
(b&&b.stop&&(k||m?b.stopPropagation():b.stop()),!i.onClick&&!c&&(!i.element||i.element=="a")?MooRTE.Utilities.exec(i.args||a):MooRTE.Utilities.eventHandler(c||"onClick",this,a))}}},i);MooRTE.btnVals[i.element?"include":"erase"]("href").each(function(a){delete o[a]});j=(new Element((k&&!i.element?"input":i.element||"a")+f,o)).inject(b,d);if(i.onUpdate||n)g.retrieve("update",{value:[],state:[],custom:[]})["fontname,fontsize,backcolor,forecolor,hilitecolor,justifyleft,justifyright,justifycenter".contains(a.toLowerCase(),
",")?"value":n?"state":"custom"].push([a,j,i.onUpdate]);i.shortcut&&(g.retrieve("shortcuts",{})[i.shortcut]=a);MooRTE.Utilities.eventHandler("onLoad",j,a)}(e=e||i.contains)&&MooRTE.Utilities.addElements(e,j);j.removeClass("rteHide")})},eventHandler:function(a,b,c){var d=MooRTE.Elements[c][a];switch(typeOf(d)){case "function":d.call(b,c,a);break;case "array":d=Array.clone(d);d.push(c,a);MooRTE.Utilities[d.shift()].apply(b,d);break;case "object":Object.every(Object.clone(d),function(d,e){MooRTE.Utilities[e].apply(b,
[d,c,a])});break;case "string":a=="source"&&a.substr(0,2)!="on"?MooRTE.Range.wrapText(d,b):MooRTE.Utilities.eventHandler(d,b,c)}},group:function(a,b){var c=this,d=this.getParent(".RTE");MooRTE.btnVals.combine(["onExpand","onHide","onShow","onUpdate"]);Array.each(MooRTE.Elements[b].hides||c.getSiblings("*[class*=rteAdd]"),function(a){a.removeClass("rteSelected");a=a.get("class").match(/rteAdd([^ ]+?)\b/)[1];d.getFirst(".rteGroup_"+a).addClass("rteHide");MooRTE.Utilities.eventHandler("onHide",c,b)});
this.addClass("rteSelected rteAdd"+b);MooRTE.Utilities.addElements(a,this.getParent("[class*=rteGroup_]"),{className:"rteGroup_"+b});MooRTE.Utilities.eventHandler("onShow",this,b)},clipStickyWin:function(a){(Browser.firefox||Browser.webkit&&a=="paste")&&window.AssetLoader&&AssetLoader.javascript(["mootools-more.js","StickyWinModalUI.js"],{onComplete:function(){MooRTE.Elements.clipPop=new StickyWin.Modal({content:StickyWin.ui("Security Restriction","For your protection, "+(Browser.webkit?"Webkit":
"Firefox")+" does not allow access to the clipboard.<br/><b>Please use Ctrl+C to copy, Ctrl+X to cut, and Ctrl+V to paste.</b><br/><br/>If this functionality is important consider switching to Internet Explorer,<br/> which allows us to access [and modify] your system.",{buttons:[{text:"close"}]})});MooRTE.Elements.clipPop.hide()}})},clean:function(a,b){b=Object.append({xhtml:!1,semantic:!0,remove:""},b);var c=[[/(<(?:img|input)[^\/>]*)>/g,"$1 />"]],d=[[/<li>\s*<div>(.+?)<\/div><\/li>/g,"<li>$1</li>"],
[/<span style="font-weight: bold;">(.*)<\/span>/gi,"<strong>$1</strong>"],[/<span style="font-style: italic;">(.*)<\/span>/gi,"<em>$1</em>"],[/<b\b[^>]*>(.*?)<\/b[^>]*>/gi,"<strong>$1</strong>"],[/<i\b[^>]*>(.*?)<\/i[^>]*>/gi,"<em>$1</em>"],[/<u\b[^>]*>(.*?)<\/u[^>]*>/gi,'<span style="text-decoration: underline;">$1</span>'],[/<p>[\s\n]*(<(?:ul|ol)>.*?<\/(?:ul|ol)>)(.*?)<\/p>/ig,"$1<p>$2</p>"],[/<\/(ol|ul)>\s*(?!<(?:p|ol|ul|img).*?>)((?:<[^>]*>)?\w.*)$/g,"</$1><p>$2</p>"],[/<br[^>]*><\/p>/g,"</p>"],
[/<p>\s*(<img[^>]+>)\s*<\/p>/ig,"$1\n"],[/<p([^>]*)>(.*?)<\/p>(?!\n)/g,"<p$1>$2</p>\n"],[/<\/(ul|ol|p)>(?!\n)/g,"</$1>\n"],[/><li>/g,">\n\t<li>"],[/([^\n])<\/(ol|ul)>/g,"$1\n</$2>"],[/([^\n])<img/ig,"$1\n<img"],[/^\s*$/g,""]],f=[[/<br class\="webkit-block-placeholder">/gi,"<br />"],[/<span class="Apple-style-span">(.*)<\/span>/gi,"$1"],[/ class="Apple-style-span"/gi,""],[/<span style="">/gi,""],[/^([\w\s]+.*?)<div>/i,"<p>$1</p><div>"],[/<div>(.+?)<\/div>/ig,"<p>$1</p>"]],e=[[/<br\s*\/?>/gi,"<br"+
(c?"/":"")+">"],[/><br\/?>/g,">"],[/^<br\/?>/g,""],[/<br\/?>$/g,""],[/<br\/?>\s*<\/(h1|h2|h3|h4|h5|h6|li|p)/gi,"</$1"],[/<p>\s*<br\/?>\s*<\/p>/gi,"<p>\u00a0</p>"],[/<p>(&nbsp;|\s)*<\/p>/gi,"<p>\u00a0</p>"],[/<p>\W*<\/p>/g,""],[/<\/p>\s*<\/p>/g,"</p>"],[/<[^> ]*/g,function(a){return a.toLowerCase()}],[/<[^>]*>/g,function(a){return a=a.replace(/ [^=]+=/g,function(a){return a.toLowerCase()})}],[/<[^>]*>/g,function(a){return a=a.replace(/( [^=]+=)([^"][^ >]*)/g,'$1"$2"')}]],g;if(typeOf(a)=="element"){g=
a;var l=g.retrieve("bar");g.contains(l)&&g!=l&&g.moorte("remove")}else g=$("washer")||(new Element("div",{id:"washer"})).inject(document.body);g.getElements("p:empty"+(b.remove?","+b.remove:"")).destroy();Browser.firefox||g.getElements("p>p:only-child").each(function(a){var b=a.getParent();b.childNodes.length==1&&a.replaces(b)});a=g.get("html");g!=$("washer")&&g.moorte();c&&e.append(c);d&&e.append(d);Browser.webkit&&e.append(f);do c=a,e.each(function(b){a=a.replace(b[0],b[1])});while(c!=a);return a.trim()},
fontsize:function(a,b){b==void 0&&(b=window.document.queryCommandValue("fontsize")||MooRTE.Range.parent().getStyle("font-size"));b==+b?b=+b+a:(b=b.split(/([^\d]+)/)[0],[0,10,13,16,18,24,32,48].every(function(c,d){if(c-b<0)return!0;b=!(c-b)||a<0?d+a:d}));MooRTE.Utilities.exec("fontsize",b)}};
MooRTE.extensions=function(){var a=Array.link(arguments,{options:Type.isObject,cmd:Type.isString,rte:Type.isElement}),b="detach,hide,remove,destroy".test(a.cmd,"i")?a.cmd.toLowerCase():"",c=Array.from(this);c.every(function(d,f){var e,g;d=c[f]=d.retrieve("new")||d;if(a.rte){e=a.rte.hasClass("MooRTE")?a.rte:a.rte.retrieve("bar");if(!e)return alert("Err 600: The passed in element is not connected to an RTE."),600;d.retrieve("bar")!=e&&(d.retrieve("bar").retrieve("fields").erase(d),d.store("bar",e),
e.retrieve("fields").include(d))}else e=d.hasClass("MooRTE")?d:d.retrieve("bar");if(b){if(!e||d.retrieve("removed")||!d.getParent())return!0}else if(e){if(e.hasClass("rteHide"))return e.removeClass("rteHide")}else return new MooRTE(Object.merge(a.options||{},{elements:this})),c[f]=d.retrieve("new")||d,!1;switch(b){case "hide":return e.addClass("rteHide");case "detach":if(d==e)return!0;e.retrieve("fields").erase(d);g=[d];break;case "remove":e.store("removed",e.getPrevious()?[e.getPrevious(),"after"]:
[e.getParent(),"top"]);e.dispose();g=e.retrieve("fields");break;case "destroy":g=e.retrieve("fields");e=e.destroy();break;default:g=[d];if(removed=e.retrieve("removed"))g=e.retrieve("fields"),e.inject(removed[0],removed[1]).eliminate("removed");else if(d==e)return;g.each(function(a){e.retrieve("fields").include(a);var b=a.retrieve("src");b?b.getParent()&&a.set("html",b.get("value")).replaces(b):(a.set("contentEditable",!0),MooRTE.Utilities.addEvents(a,a.retrieve("rteEvents")),Browser.firefox&&!a.getElement("#rteMozFix")&&
a.grab(new Element("div",{id:"retMozFix",styles:{display:"none"}})))});return!0}c[f]=d.retrieve("src")||d;g.each(function(a){Browser.firefox&&a.getElement("#rteMozFix")&&a.getElement("#rteMozFix").destroy();var b=a.retrieve("src");b?(b.set("value",a.get("html")).replaces(a),e||(b.eliminate("new"),a.destroy())):(a.set("contentEditable",!1),MooRTE.Utilities.removeEvents(a,destroy),e||a.eliminate("bar"))});return!0}.bind(this));return c};Element.implement({moorte:MooRTE.extensions});Elements.implement({moorte:MooRTE.extensions});
MooRTE.Elements={Main:{text:"Main","class":"rteText",onClick:"onLoad",onLoad:{group:{Toolbar:["start","bold","italic","underline","strikethrough","Justify","Lists","Indents","subscript","superscript"]}}},File:{text:"File","class":"rteText",onClick:{group:{Toolbar:["start","save","cut","copy","paste","redo","undo","selectall","removeformat","viewSource"]}}},Font:{text:"Font","class":"rteText",onClick:["group",{Toolbar:["start","fontsize","decreasefontsize","increasefontsize","backcolor","forecolor"]}]},
Insert:{text:"Insert","class":"rteText",onClick:["group",{Toolbar:["start","inserthorizontalrule","blockquote","hyperlink"]}]},View:{text:"Views","class":"rteText",onClick:["group",{Toolbar:["start","Html/Text"]}]},Justify:{img:6,"class":"Flyout rteSelected",contains:"div.Flyout:[justifyleft,justifycenter,justifyright,justifyfull]"},Lists:{img:14,"class":"Flyout",contains:"div.Flyout:[insertorderedlist,insertunorderedlist]"},Indents:{img:11,"class":"Flyout",contains:"div.Flyout:[indent,outdent]"},
div:{element:"div"},bold:{img:1,shortcut:"b",source:"<b>"},italic:{img:2,shortcut:"i",source:"<i>"},underline:{img:3,shortcut:"u",source:"<u>"},strikethrough:{img:4},justifyleft:{img:6,title:"Justify Left",onUpdate:function(a,b){var c=MooRTE.activeField.retrieve("bar").getElement(".rtejustify"+(b=="justify"?"full":b)),d=c.addClass("rteSelected").getStyle("background-position");c.getParent().getParent().setStyle("background-position",d)}},justifyfull:{img:7,title:"Justify Full"},justifycenter:{img:8,
title:"Justify Center"},justifyright:{img:9,title:"Justify Right"},subscript:{img:18},superscript:{img:17},outdent:{img:11},indent:{img:12},insertorderedlist:{img:14,title:"Numbered List"},insertunorderedlist:{img:15,title:"Bulleted List"},selectall:{img:25,title:"Select All (Ctrl + A)"},removeformat:{img:26,title:"Clear Formatting"},undo:{img:31,title:"Undo (Ctrl + Z)"},redo:{img:32,title:"Redo (Ctrl+Y)"},inserthorizontalrule:{img:56,title:"Insert Horizontal Line"},cut:{img:20,title:"Cut (Ctrl+X)",
onLoad:MooRTE.Utilities.clipStickyWin,onClick:function(a){Browser.firefox?MooRTE.Elements.clipPop.show():MooRTE.Utilities.exec(a)}},copy:{img:21,title:"Copy (Ctrl+C)",onLoad:MooRTE.Utilities.clipStickyWin,onClick:function(a){Browser.firefox?MooRTE.Elements.clipPop.show():MooRTE.Utilities.exec(a)}},paste:{img:22,title:"Paste (Ctrl+V)",onLoad:MooRTE.Utilities.clipStickyWin,onClick:function(a){Browser.firefox||Browser.webkit?MooRTE.Elements.clipPop.show():MooRTE.Utilities.exec(a)}},save:{img:27,src:"http://siteroller.net/test/save.php",
onClick:function(){var a={page:window.location.pathname},b=0;a.content=[];this.getParent(".MooRTE").retrieve("fields").each(function(c){a.content[b++]=MooRTE.Utilities.clean(c)});(new Request({url:MooRTE.Elements.save.src,onComplete:function(a){alert("Your submission has been received:\n\n"+a)}})).send(Object.toQueryString(a))}},"Html/Text":{img:"26",onClick:["DisplayHTML"]},DisplayHTML:{element:"textarea",unselectable:"off","class":"displayHtml",init:function(){var a=this.getParent(".MooRTE").retrieve("fields"),
b=a.getParent();b=(b.hasClass("rteTextArea")?b:a).getSize();this.set({styles:{width:b.x,height:b.y},text:a.innerHTML.trim()})}},colorpicker:{element:"img",src:"images/colorPicker.jpg","class":"colorPicker",onClick:function(){var a=this.getSize().x/2,b=mouse.x-a,c=mouse.y-a,d=f.y/f.getSize().y,f=Math.atan2(b,c)/Math.PI*3+1;a=Math.sqrt(b*b+c*c)/a;for(b=0;b<3;b++)(void 0)[b]=(((Math.abs((f+=2)%6-3)<1?1:h>2?0:-(h-2))-d)*a+d)*255;[(void 0)[0],(void 0)[2],(void 0)[1]].rgbToHex()}},hyperlink:{img:46,title:"Create hyperlink",
onClick:function(){MooRTE.Range.create();$("popTXT").set("value",MooRTE.Range.get("text",MooRTE.ranges.a1));MooRTE.Elements.linkPop.show()},onLoad:function(){window.Asset&&new Asset.javascript("StickyWinModalUI.js",{self:this,onComplete:function(){MooRTE.Elements.linkPop=new StickyWin.Modal({content:StickyWin.ui("Edit Link","<span style='display:inline-block; width:100px'>Text of Link:</span><input id='popTXT'/><br/><span style='display:inline-block; width:100px'>Link To Location:</span><input id='popURL'/><br/><input type='radio' name='pURL'  value='web' checked/>Web<input type='radio' name='pURL' id='pURL1' value='email'/>Email",
{buttons:[{text:"cancel"},{text:"OK",onClick:function(){MooRTE.Range.set();var a=$("popURL").get("value");$("pURL1").get("checked")&&(a="mailto:"+a);MooRTE.Utilities.exec(a?"createlink":"unlink",a)}}]})});MooRTE.Elements.linkPop.hide()}})}},"Upload Photo":{img:15,onLoad:function(){MooRTE.Utilities.assetLoader({scripts:["/siteroller/classes/fancyupload/fancyupload/source/Swiff.Uploader.js"],styles:["/siteroller/classes/fancyupload/fancyupload/source/Swiff.Uploader.css"],onComplete:function(){var a=
new Swiff.Uploader({verbose:!0,target:this,queued:!1,multiple:!1,instantStart:!0,fieldName:"photoupload",typeFilter:{"Images (*.jpg, *.jpeg, *.gif, *.png)":"*.jpg; *.jpeg; *.gif; *.png"},path:"/siteroller/classes/fancyupload/fancyupload/source/Swiff.Uploader.swf",url:"/siteroller/classes/moorte/source/plugins/fancyUpload/uploadHandler.php",onButtonDown:function(){MooRTE.Range.set()},onButtonEnter:function(){MooRTE.Range.create()},onFileProgress:function(){},onFileComplete:function(a){MooRTE.Range.set().exec("insertimage",
JSON.decode(a.response.text).file)}});this.addEvent("mouseenter",function(){a.target=this;a.reposition()})}})}},blockquote:{img:59,onClick:function(){MooRTE.Range.wrap("blockquote")}},start:{element:"span"},viewSource:{img:35,onClick:"source",source:function(a){var b=MooRTE.activeBar,c=b.retrieve("fields")[0],d=b.getElement("textarea.rtesource");this.hasClass("rteSelected")?(b.eliminate("source"),this.removeClass("rteSelected"),c.contains(c.retrieve("bar"))&&c.moorte("remove"),c.set("html",d.addClass("rteHide").get("value")).moorte()):
(b.store("source","source"),d?(this.addClass("rteSelected"),d.removeClass("rteHide").set("text",MooRTE.Utilities.clean(b.retrieve("fields")[0]))):MooRTE.Utilities.group.apply(this,["source",a]))}},source:{element:"textarea","class":"displayHtml",unselectable:"off",onLoad:function(){var a=this.getParent(".MooRTE"),b=a.retrieve("fields")[0],c=b.getSize();a=a.getSize().y;this.set({styles:{width:c.x,height:c.y-a,top:a},text:MooRTE.Utilities.clean(b)})}},input:{img:59,onClick:function(){MooRTE.Range.insert("<input>")}},
submit:{img:59,onClick:function(){MooRTE.Range.insert('<input type="submit" value="Submit">')}},cleanWord:{onClick:function(){var a=this.replace(/\r/g,"\n").replace(/\n/g," ");[/<\!--.+?--\>/g,/<title>.+?<\/title>/g,/<(meta|link|.?o:|.?style|.?div|.?head|.?html|body|.?body|.?span|!\[)[^>]*?>/g,/ v:.*?=".*?"/g,/ style=".*?"/g,/ class=".*?"/g,/(&nbsp;){2,}/g,/<p>(\s|&nbsp;)*?<\/p>/g].each(function(b){a=a.replace(b,"")});return a.replace(/\s+/g," ")}},decreasefontsize:{img:42,onClick:function(){if(!Browser.firefox)return MooRTE.Utilities.fontsize.pass(-1)}()},
increasefontsize:{img:41,onClick:function(){if(!Browser.firefox)return MooRTE.Utilities.fontsize.pass(1)}()},fontsize:{},insertimage:{},forecolor:{},formatblock:{},backcolor:{img:43,onLoad:function(){MooRTE.Utilities.assetLoader({scripts:["/siteroller/classes/colorpicker/Source/ColorRoller.js"],styles:["/siteroller/classes/colorpicker/Source/ColorRoller.js"],onComplete:function(){}})},onClick:function(){}},Toolbar:{element:"div"}};